/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/Utils","sap/ui/fl/changeHandler/Base","sap/base/util/LoaderExtensions"],function(U,B,L){"use strict";var A={};var d=function(c){c.forEach(function(C){if(C.destroy){C.destroy();}});};A.applyChange=function(c,C,p){var m=p.modifier;var o=c.getDefinition();var a=o.content.targetAggregation;var n=B.instantiateFragment(c,p);var i=o.content.index;var v=p.view;var b=m.findAggregation(C,a);if(!b){d(n);throw new Error("The given Aggregation is not available in the given control: "+m.getId(C));}var M=c.getModuleName();var f=L.loadResource(M,{dataType:"text"});n.forEach(function(N,I){if(!m.validateType(N,b,C,f,I)){d(n);throw new Error("The content of the xml fragment does not match the type of the targetAggregation: "+b.type);}});n.forEach(function(N,I){m.insertAggregation(C,a,N,i+I,v);});c.setRevertData(n.map(function(e){return m.getId(e);}));return true;};A.revertChange=function(c,C,p){var m=p.modifier;var o=c.getDefinition();var a=o.content.targetAggregation;var v=p.view||U.getViewForControl(C);var b=p.appComponent;var r=c.getRevertData()||[];var e=r.map(function(i){return m.bySelector(i,b,v)||v&&v.createId&&m.bySelector(v.createId(i));});e.forEach(function(f){m.removeAggregation(C,a,f);});d(e);c.resetRevertData();return true;};A.completeChangeContent=function(c,s){var C=c.getDefinition();var _=function(a){throw new Error("Attribute missing from the change specific content'"+a+"'");};if(!C.content){C.content={};}if(s.fragmentPath){C.content.fragmentPath=s.fragmentPath;}else{_("fragmentPath");}if(s.targetAggregation){C.content.targetAggregation=s.targetAggregation;}else{_("targetAggregation");}if(s.index!==undefined){C.content.index=s.index;}else{_("index");}var g=function(C){var m=C.reference.replace(/\./g,"/");m+="/changes/";m+=C.content.fragmentPath.replace(/\.fragment\.xml/g,"");return m;};var m=g(C);c.setModuleName(m);};return A;},true);
