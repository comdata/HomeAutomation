/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/LrepConnector","sap/ui/fl/Utils","sap/ui/fl/LayerUtils","sap/ui/fl/context/Context","sap/base/Log"],function(L,U,a,C,b){"use strict";var c;c={_oContext:new C({configuration:{device:"sap/ui/fl/context/DeviceContextProvider",switches:"sap/ui/fl/context/SwitchContextProvider"}}),_oLrepConnector:L.createConnector(),doesContextMatch:function(o,A){var s=o.context||"";if(!s){return true;}return A&&A.indexOf(s)!==-1;},getActiveContexts:function(d){var D=this._getContextIdsFromUrl();if(D.length===0){return this._getContextParametersFromAPI(d).then(this._getActiveContextsByAPIParameters.bind(this,d));}return Promise.resolve(this._getActiveContextsByUrlParameters(d,D));},_getContextParametersFromAPI:function(d){var r=[];d.forEach(function(o){o.parameters.forEach(function(e){var s=e.selector;if(r.indexOf(s)===-1){r.push(s);}});});return this._oContext.getValue(r);},_getActiveContextsByAPIParameters:function(d,r){var t=this;var A=[];d.forEach(function(o){if(t._isContextObjectActive(o,r)){A.push(o.id);}});return A;},_getActiveContextsByUrlParameters:function(d,D){var A=[];d.forEach(function(o){var e=((D?Array.prototype.indexOf.call(D,o.id):-1))!==-1;if(e){A.push(o.id);}});return A;},_isContextObjectActive:function(o,r){var t=this;var d=true;var p=o.parameters;p.every(function(P){d=d&&t._checkContextParameter(P,r);return d;});return d;},_getContextIdsFromUrl:function(){var s=U.getUrlParameter("sap-ui-flexDesignTimeContext");if(!s){return[];}return s.split(",");},_checkContextParameter:function(p,r){var s=p.selector;var o=p.operator;var v=p.value;switch(o){case"EQ":return this._checkEquals(s,v,r);case"NE":return!this._checkEquals(s,v,r);default:b.info("A context within a flexibility change with the operator '"+o+"' could not be verified");return false;}},_checkEquals:function(s,v,r){return r[s]===v;},createOrUpdateContextObject:function(p){if(!p.reference){throw new Error("no reference passed for the context object");}if(!p.namespace){throw new Error("no namespace passed for the context object");}var i=p.id||U.createDefaultFileName();p={id:i,fileName:i,title:p.title||"",description:p.description||"",parameters:p.parameters||[],fileType:"context",reference:p.reference||"",packageName:p.packageName||"",layer:p.layer||a.getCurrentLayer(false),namespace:p.namespace,creation:p.creation||"",originalLanguage:p.originalLanguage||U.getCurrentLanguage(),support:p.support||{generator:p.generator||"",service:"",user:""},validAppVersions:p.validAppVersions||{}};var u="/sap/bc/lrep/content/"+p.namespace+p.fileName+".context";u+="?layer="+p.layer;var m="PUT";return this._oLrepConnector.send(u,m,p,{});}};return c;},true);
