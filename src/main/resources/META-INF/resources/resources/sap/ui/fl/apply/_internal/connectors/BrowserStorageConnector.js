/*
 * ! OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/fl/library","sap/ui/fl/apply/connectors/BaseConnector","sap/ui/fl/apply/_internal/connectors/BrowserStorageUtils","sap/ui/fl/LayerUtils"],function(m,l,B,c,L){"use strict";function d(p){var F=[];c.forEachChangeInStorage(p,function(a){F.push(a.changeDefinition);});return F;}function g(F){var G={};Object.keys(l.Layer).forEach(function(s){G[s]={variants:[],variantChanges:[],variantManagementChanges:[],variantDependentControlChanges:[],changes:[],index:L.getLayerIndex(s)};});F.forEach(function(o){var s=o.layer;if(o.fileType==="ctrl_variant"&&o.variantManagementReference){G[s].variants.push(o);}else if(o.fileType==="ctrl_variant_change"){G[s].variantChanges.push(o);}else if(o.fileType==="ctrl_variant_management_change"){G[s].variantManagementChanges.push(o);}else if(o.fileType==="change"){if(o.variantReference){G[s].variantDependentControlChanges.push(o);}else{G[s].changes.push(o);}}});Object.keys(G).forEach(function(s){c.sortGroupedFlexObjects(G[s]);});return G;}function f(G){var r=[];Object.keys(G).forEach(function(s){r.push(G[s]);});r=r.filter(function(R){return R.changes.length>0||R.variants.length>0||R.variantChanges.length>0||R.variantManagementChanges.length>0||R.variantDependentControlChanges.length>0;});r.sort(function(a,b){return a.index-b.index;});return r;}var e=m({},B,{oStorage:undefined,loadFlexData:function(p){var F=d({storage:this.oStorage,reference:p.reference});var G=g(F);var r=f(G);return Promise.resolve(r);}});return e;},true);
