/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/fl/LrepConnector","sap/ui/fl/Cache","sap/ui/fl/ChangePersistenceFactory","sap/ui/fl/Utils"],function(q,L,C,a,U){"use strict";var l=Object.create(L.prototype);F._oBackendInstances={};function F(i){this.sInitialComponentJsonPath=i;this.mSettings={};this.mInfo={};}for(var p in l){if(typeof l[p]==='function'){F.prototype[p]=(function(p){return function(){throw new Error('Method '+p+'() is not implemented in FakeLrepConnector.');};}(p));}}F.prototype._getUrlPrefix=function(i){if(i){return U.getLrepUrl()+"/variants/";}return U.getLrepUrl()+"/changes/";};F.prototype.getFlexInfo=function(){return Promise.resolve(this.mInfo);};F.prototype.setInfo=function(i){this.mInfo=i;};F.prototype.loadSettings=function(){this.setFlexServiceAvailability(true);return Promise.resolve(this.mSettings);};F.prototype.setSettings=function(s){this.mSettings=s;};F.prototype.setFlexServiceAvailability=function(A){L._bServiceAvailability=A;};F.prototype.loadChanges=function(s){var i=this.sInitialComponentJsonPath;return new Promise(function(r,f){q.getJSON(i).done(function(R){var g={changes:R,componentClassName:s};r(g);}).fail(function(g){f(g);});});};F.prototype.create=function(f,g,i){if(!i){return Promise.resolve();}if(!f.creation){f.creation=new Date().toISOString();}return Promise.resolve({response:f,status:'success'});};F.prototype.update=function(f){if(!f.fileType||(f.fileType!=="variant")){return Promise.resolve();}return Promise.resolve({response:f,status:'success'});};F.prototype.deleteChange=function(f){if(!f.fileType||(f.fileType!=="variant")){return Promise.resolve();}return Promise.resolve({response:undefined,status:'nocontent'});};F.prototype.send=function(u,m,D,o){return new Promise(function(r,f){e(u,m,D,o,r,f);d(u,m,D,o,r,f);c(u,m,D,o,r,f);b(u,m,D,o,r,f);h(u,m,D,o,r,f);});};function h(u,m,D,o,r){var f=/\/sap\/bc\/lrep\/appdescr_variants\/([\w.]+)/;var g=f.exec(u);if(g&&m==='GET'){var R={content:[],fileName:"manifest",fileType:"appdescr_variant",id:g[1],layer:"CUSTOMER",namespace:"apps/sap.ui.test.application/appVariants/"+g[1],packageName:"$TMP",reference:"sap.ui.test.application"};r({response:JSON.stringify(R)});}else if(g&&m==='DELETE'){r();}}function b(u,m,D,o,r){if(u.match(/^\/sap\/bc\/lrep\/changes\//)&&m==='DELETE'){var f=[];var g=/\?reference=([\w.]+)\&.+\&layer=(\w+)\&generator=([\w.]+)/;f=u.match(g);r({response:{parameters:f},status:"success"});}}function c(u,m,D,o,r){if(u.match(/^\/sap\/bc\/ui2\/app_index\/ui5_app_mani_first_supported\//)&&m==='GET'){r({response:false,status:"success"});}}function d(u,m,D,o,r){if(u.match(/^\/sap\/bc\/lrep\/actions\/make_changes_transportable\//)&&m==='POST'){r();}}function e(u,m,D,o,r){if(u.match(/^\/sap\/bc\/lrep\/actions\/gettransports\//)){r({response:{transports:[{transportId:"U31K008488",description:"The Ultimate Transport",owner:"Fantasy Owner",locked:true}],localonly:false,errorCode:""}});}}F.enableFakeConnector=function(i,A,s){function r(){F.enableFakeConnector.original=L.createConnector;L.createConnector=function(){if(!F._oFakeInstance){F._oFakeInstance=new F(i);}return F._oFakeInstance;};}if(A&&s){var o=a.getChangePersistenceForComponent(A,s);if(!(o._oConnector instanceof F)){F.clearCacheAndResetVariants(A,s,o);if(!F._oBackendInstances[A]){F._oBackendInstances[A]={};}F._oBackendInstances[A][s]=o._oConnector;o._oConnector=new F(i);}r();return;}C.clearEntries();if(F.enableFakeConnector.original){return;}r();};F.disableFakeConnector=function(A,s){function r(){if(F.enableFakeConnector.original){L.createConnector=F.enableFakeConnector.original;F.enableFakeConnector.original=undefined;F._oFakeInstance=undefined;}}if(A&&s){var o=a.getChangePersistenceForComponent(A,s);if(!(o._oConnector instanceof L)){F.clearCacheAndResetVariants(A,s,o);if(F._oBackendInstances[A]&&F._oBackendInstances[A][s]){o._oConnector=F._oBackendInstances[A][s];F._oBackendInstances[A][s]=undefined;}}r();return;}C.clearEntries();r();};F.clearCacheAndResetVariants=function(s,A,o){C.clearEntry(s,A);o.resetVariantMap(true);};return F;},true);
