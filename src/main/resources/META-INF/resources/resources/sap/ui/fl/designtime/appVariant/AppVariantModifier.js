/*
 * ! OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/descriptorRelated/api/DescriptorInlineChangeFactory","sap/ui/fl/designtime/appVariant/ModifierUtils","sap/base/util/includes"],function(D,M,i){"use strict";var A={};A.DESCRIPTOR_CHANGE_PATTERN={NAMESPACE:"/descriptorChanges/",FILETYPE:".change"};var _=D.getCondensableDescriptorChangeTypes();var a="/manifest.appdescr_variant";function b(c){return i(_,c);}function s(c,C){if(c.creation===C.creation){return 0;}return c.creation>C.creation?1:-1;}A.modify=function(n,f){if(f.length!==0){var S=A._separateDescriptorAndInlineChangesFromOtherFiles(f);var r=S.inlineChanges.concat(S.descriptorChanges.sort(s)).concat(n.content);n.content=A._condenseDescriptorChanges(r);f=S.otherFiles;}f.push({fileName:a,content:JSON.stringify(n)});return f;};A._separateDescriptorAndInlineChangesFromOtherFiles=function(f){var d=[];var I=[];var o=[];f.forEach(function(F){if(M.fileNameMatchesPattern(F.fileName,A.DESCRIPTOR_CHANGE_PATTERN)){var c=JSON.parse(F.content);d.push(c);}else if(F.fileName===a){var O=JSON.parse(F.content);I=O.content;}else{o.push(F);}});return{descriptorChanges:d,inlineChanges:I,otherFiles:o};};A._condenseDescriptorChanges=function(d){var c=[];var C=[];d.reverse().forEach(function(o){var e=o.changeType;if(!i(c,e)){C.push(o);if(b(e)){c.push(e);}}});return C.reverse();};return A;},false);
