/*
 * ! OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/security/encodeURLParameters","sap/base/Log"],function(e,L){"use strict";var A="sap/ui/fl/apply/_internal/connectors/";var S={layerFilter:[],connector:"StaticFileConnector"};function _(l,v){return l.filter(function(s){return v.indexOf(s)!==-1||v[0]==="ALL";});}return{getConnectors:function(n,l){var c=sap.ui.getCore().getConfiguration().getFlexibilityServices();var C=[];if(l){C=[S];}C=C.concat(c);return new Promise(function(r){var a=C.map(function(m){var s=m.connector;var b;if(!m.custom){b=n+s;}else{b=l?m.applyConnector:m.writeConnector;}return b;});sap.ui.require(a,function(){Array.from(arguments).forEach(function(o,i){if(!l){if(!C[i].layers){C[i].layers=o.layers;}else{C[i].layers=_(C[i].layers,o.layers);}}C[i].connectorModule=o;});r(C);});});},getApplyConnectors:function(){return this.getConnectors(A,true);},logAndResolveDefault:function(r,c,f,E){L.error("Connector ("+c.connector+") failed call '"+f+"': "+E);return r;},getUrl:function(r,p,P){if(!r||!p.url){throw new Error("Not all necessary parameters were passed");}var u=p.url+r;if(p.cacheKey){u+="~"+p.cacheKey+"~/";}if(p.reference){u+=p.reference;}else if(p.fileName){u+=p.fileName;}if(P){Object.keys(P).forEach(function(k){if(P[k]===undefined){delete P[k];}});var q=e(P);if(q.length>0){u+="?"+q;}}return u;},sendRequest:function(u,m,p){m=m||"GET";m=m.toUpperCase();return new Promise(function(r,a){var x=new XMLHttpRequest();x.open(m,u);if((m==="GET"||m==="HEAD")&&(!p||!p.xsrfToken)){x.setRequestHeader("X-CSRF-Token","fetch");}if((m==="POST"||m==="PUT"||m==="DELETE")&&p&&p.xsrfToken){x.setRequestHeader("X-CSRF-Token",p.xsrfToken);}if(p&&p.contentType){x.setRequestHeader("Content-Type",p.contentType);}if(p&&p.dataType){x.responseType=p.dataType;}if(p&&p.payload){x.send(p.payload);}else{x.send();}x.onload=function(){if(x.status>=200&&x.status<400){var R={};var c=x.getResponseHeader("Content-Type");if(c&&c.startsWith("application/json")){R.response=x.response?JSON.parse(x.response):undefined;}R.status=x.status;R.xsrfToken=x.getResponseHeader("X-CSRF-Token");r(R);}else{a({status:x.status,message:x.statusText});}};});},getEmptyFlexDataResponse:function(){return Object.assign({},{changes:[],variants:[],variantChanges:[],variantDependentControlChanges:[],variantManagementChanges:[]});}};});
