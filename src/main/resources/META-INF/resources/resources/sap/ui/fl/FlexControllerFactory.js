/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/FlexController","sap/ui/fl/Utils","sap/ui/fl/ChangePersistenceFactory","sap/ui/fl/variants/VariantModel","sap/base/Log"],function(F,U,C,V,L){"use strict";var a={};a._instanceCache={};a.create=function(c,A){A=A||U.DEFAULT_APP_VERSION;if(!a._instanceCache[c]){a._instanceCache[c]={};}var f=a._instanceCache[c][A];if(!f){f=new F(c,A);a._instanceCache[c][A]=f;}return f;};a.createForControl=function(c,m){try{var A=U.getAppComponentForControl(c);var s=U.getComponentClassName(A||c);var b=U.getAppVersionFromManifest(A?A.getManifest():m);return a.create(s,b);}catch(e){L.error(e.message,undefined,"sap.ui.fl.FlexControllerFactory");}};a.getChangesAndPropagate=function(c,v){if(U.isApplicationComponent(c)){return _(c,v);}else if(U.isEmbeddedComponent(c)){var A=U.getAppComponentForControl(c);if(A){return Promise.resolve().then(function(){var e=A.getModel(U.VARIANT_MODEL_NAME);if(!e){return _(A,v);}return e;}).then(function(o){c.setModel(o,U.VARIANT_MODEL_NAME);});}}};function _(A,c){var m=A.getManifestObject();var f;f=a.createForControl(A,m);return C._getChangesForComponentAfterInstantiation(c,m,A).then(function(g){A.addPropagationListener(f.getBoundApplyChangesOnControl(g,A));var d=f.getVariantModelData()||{};var v=new V(d,f,A);A.setModel(v,U.VARIANT_MODEL_NAME);return v;});}return a;},true);
