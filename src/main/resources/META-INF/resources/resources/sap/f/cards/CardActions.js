/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/f/library","sap/ui/base/ManagedObject","sap/base/Log","sap/f/cards/BindingResolver"],function(l,M,L,B){"use strict";function _(s){if(s&&typeof s==="object"){return s.name;}return s;}var A=l.cards.AreaType;var C=M.extend("sap.f.cards.CardActions",{metadata:{properties:{areaType:{type:"sap.f.cards.AreaType",defaultValue:A.None}}}});C.prototype.exit=function(){this._oAreaControl=null;};C.prototype.attach=function(i,a){this._oAreaControl=a;if(!i.actions){this._fireActionReady();return;}var o=i.actions[0];if(o&&o.type==="Navigation"){this._attachNavigationAction(i);}else{this._fireActionReady();}};C.prototype._setItemTemplateTypeFormatter=function(a){var t=this,o=t._oAreaControl,i=o._oItemTemplate;var b=M.bindingParser("{path:''}");b.formatter=function(v){var c=this.getBindingContext(),m=this.getModel(),p,P;if(c){p=c.getPath();}P=B.resolveValue(a.parameters,m,p);if(v.__resolved){if(v.__enabled){return"Navigation";}else{return"Inactive";}}if(!v.__promise){v.__promise=true;o._oServiceManager.getService(_(a.service)).then(function(n){if(n){n.enabled({parameters:P}).then(function(e){v.__resolved=true;v.__enabled=e;o.getModel().checkUpdate(true);}).catch(function(){v.__resolved=true;v.__enabled=false;});}else{v.__resolved=true;v.__enabled=false;}});}return"Inactive";};i.bindProperty("type",b);};C.prototype._setSingleActionEnabledState=function(i){var a=i.actions[0],o=this._oAreaControl,b=o.getBindingContext(),p=a.parameters,m=o.getModel(),P;if(b){P=b.getPath();}p=B.resolveValue(a.parameters,m,P);return new Promise(function(r){o._oServiceManager.getService(_(a.service)).then(function(n){if(n){n.enabled({parameters:p}).then(function(e){r(e);}).catch(function(){r(false);});}else{r(false);}}).catch(function(){r(false);});});};C.prototype._setItemTemplateEnabledState=function(a){var b,t,i=this._oAreaControl._oItemTemplate;if(typeof a.enabled==="string"){b=M.bindingParser(a.enabled);b.formatter=function(v){if(v&&(typeof v==="string")){return"Navigation";}else{return"Inactive";}};}if(b){i.bindProperty("type",b);}else{t=a.enabled!==false?"Navigation":"Inactive";i.setProperty("type",t);}};C.prototype._addClickableClass=function(){this._oAreaControl.addStyleClass("sapFCardClickable");};C.prototype._fireActionReady=function(){var h=this.getAreaType()===A.Header;var e=h?"_actionHeaderReady":"_actionContentReady";this._oAreaControl.fireEvent(e);};C.prototype._attachNavigationAction=function(i){var a=i.actions[0],o=this.getAreaType()===A.ContentItem?this._oAreaControl._oItemTemplate:this._oAreaControl,h,c=true,s=this.getAreaType(),S=s===A.Header||s===A.Content,b=s===A.ContentItem;var d=function(){o.attachPress(h.bind(this));if(S){this._addClickableClass();}}.bind(this);if(a.service){if(this.getAreaType()===A.ContentItem){this._setItemTemplateTypeFormatter(a);}h=function(E){var f=E.getSource(),g=f.getBindingContext(),m=f.getModel(),p;if(g){p=g.getPath();}this._oAreaControl._oServiceManager.getService(_(a.service)).then(function(n){if(n){n.navigate({parameters:B.resolveValue(a.parameters,m,p)});}}).catch(function(e){L.error("Navigation service unavailable",e);}).finally(function(){this._fireAction(E.getSource(),a.parameters,m,p);}.bind(this));}.bind(this);c=false;}else{if(b){this._setItemTemplateEnabledState(a);c=false;}if(a.url){h=function(e){var f=e.getSource(),g=f.getBindingContext(),m=f.getModel(),p,u;if(g){p=g.getPath();}u=B.resolveValue(a.url,m,p);this.openUrl(u,a);this._fireAction(e.getSource(),a.parameters,m,p);}.bind(this);}else{h=function(e){var f=e.getSource(),g=f.getBindingContext(),m=f.getModel(),p;if(g){p=g.getPath();}this._fireAction(e.getSource(),a.parameters,m,p);}.bind(this);}}if(S&&a.service){this._setSingleActionEnabledState(i).then(function(e){if(e){d();}this._fireActionReady();}.bind(this));}else{if(c){if(a.enabled!==false){d();}}else{d();}this._fireActionReady();}};C.prototype.openUrl=function(u,a){window.open(u,a.target||"_blank");};C.prototype._fireAction=function(s,a,m,p){this._oAreaControl.fireEvent("action",{type:"Navigation",actionSource:s,manifestParameters:B.resolveValue(a,m,p)});};return C;});
