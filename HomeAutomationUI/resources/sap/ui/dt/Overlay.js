/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2015 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/core/Control','sap/ui/dt/ElementUtil','sap/ui/dt/OverlayUtil','sap/ui/dt/DOMUtil','jquery.sap.dom'],function(q,C,E,O,D){"use strict";var o="overlay-container";var a;var b=C.extend("sap.ui.dt.Overlay",{metadata:{library:"sap.ui.dt",properties:{},associations:{element:{type:"sap.ui.core.Element"}},aggregations:{},events:{destroyed:{parameters:{}}}}});b.getOverlayContainer=function(){if(!a){a=q.sap.byId(o);if(!a.length){a=q("<div id='"+o+"'></div>").appendTo("body");}}return a.get(0);};b.removeOverlayContainer=function(){if(a){a.remove();}a=null;};b.prototype.init=function(){this.attachBrowserEvent("scroll",this._onScroll,this);};b.prototype._onChildRerenderedEmpty=function(){return true;};b.prototype.exit=function(){delete this._oDomRef;this.fireDestroyed();};b.prototype.onBeforeRendering=function(){if(this.hasFocus()){this._bRestoreFocus=true;}};b.prototype.onAfterRendering=function(){this._oDomRef=this.getDomRef();if(this._oDomRef){this._updateDom();}if(this._bRestoreFocus){delete this._bRestoreFocus;this.focus();}};b.prototype.getDomRef=function(){return this._oDomRef||C.prototype.getDomRef.apply(this,arguments);};b.prototype.getElementInstance=function(){return sap.ui.getCore().byId(this.getElement());};b.prototype.hasFocus=function(){return document.activeElement===this.getFocusDomRef();};b.prototype.applyStyles=function(){var g=this.getGeometry();if(g){var $=this.$();var c=this.getParent();var p=(c&&c instanceof b)?c.$().scrollTop():null;var P=(c&&c instanceof b)?c.$().scrollLeft():null;var m=(c&&c instanceof b)?c.$().offset():null;var d=D.getOffsetFromParent(g.position,m,p,P);var s=g.size;$.css("width",s.width+"px");$.css("height",s.height+"px");$.css("top",d.top+"px");$.css("left",d.left+"px");var z=D.getZIndex(g.domRef);if(z){$.css("z-index",z);}var e=D.getOverflows(g.domRef);if(e){if(e.overflowX){$.css("overflow-x",e.overflowX);}if(e.overflowY){$.css("overflow-y",e.overflowY);}var S=g.domRef.scrollHeight;var i=g.domRef.scrollWidth;if(S>s.height||i>s.width){this._oDummyScrollContainer=q("<div class='sapUiDtDummyScrollContainer' style='height: "+S+"px; width: "+i+"px;'></div>");this.$().append(this._oDummyScrollContainer);}D.syncScroll(g.domRef,this.getDomRef());}this.getChildren().forEach(function(f){f.applyStyles();});if(this._oDummyScrollContainer){this._oDummyScrollContainer.remove();delete this._oDummyScrollContainer;}}};b.prototype.getGeometry=function(){var d=this.getAssociatedDomRef();var g=D.getGeometry(d);if(!g){var c=[];this.getChildren().forEach(function(e){c.push(e.getGeometry());});g=O.getGeometry(c);}return g;};b.prototype._updateDom=function(){var g=this.getGeometry();var p=this.getParent();if(p){if(p.getDomRef){var P=p.getDomRef();if(P!==this.$().parent().get(0)){this.$().appendTo(P);}}else{var a=b.getOverlayContainer();if(a!==this.$().parent().get(0)){this.$().appendTo(a);}this.applyStyles();}}if(g&&this.isVisible()){this.$().show();}else{this.$().hide();}};b.prototype._onScroll=function(){var g=this.getGeometry();var d=g?g.domRef:null;if(d){D.syncScroll(this.$(),d);}};return b;},true);
