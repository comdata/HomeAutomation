/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2015 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/dt/plugin/DragDrop','sap/ui/dt/ElementUtil','sap/ui/dt/DOMUtil'],function(D,E,a){"use strict";var C=D.extend("sap.ui.dt.plugin.ControlDragDrop",{metadata:{library:"sap.ui.dt",properties:{draggableTypes:{type:"string[]",defaultValue:["sap.ui.core.Element"]}},associations:{},events:{}}});C.prototype.registerOverlay=function(o){D.prototype.registerOverlay.apply(this,arguments);var e=o.getElementInstance();if(this.isDraggableType(e)&&this.checkDraggable(o)){o.setDraggable(true);}if(this.oDraggedElement){this._activateValidDroppablesFor(o);}};C.prototype._getDraggableTypes=function(){return this.getProperty("draggableTypes")||[];};C.prototype.isDraggableType=function(e){var d=this._getDraggableTypes();return d.some(function(t){return E.isInstanceOf(e,t);});};C.prototype.checkDraggable=function(o){return true;};C.prototype.deregisterOverlay=function(o){D.prototype.deregisterOverlay.apply(this,arguments);o.setDraggable(false);if(this.oDraggedElement){this._deactivateDroppablesFor(o);}};C.prototype.onDragStart=function(o,e){this._activateAllValidDroppables();};C.prototype.onDragEnd=function(o){delete this._oPreviousTarget;this._deactivateAllDroppables();};C.prototype.onDragEnter=function(t,e){if(t.getElementInstance()!==this.getDraggedOverlay().getElementInstance()&&t!==this._oPreviousTarget){this._repositionOn(t);}this._oPreviousTarget=t;};C.prototype.onAggregationDragEnter=function(A){delete this._oPreviousTarget;var t=A.getElementInstance();var d=this.getDraggedOverlay().getElementInstance();var s=this.getDraggedOverlay().getParentElementOverlay();var S;if(s){S=s.getElementInstance();}if(t!==S){var b=A.getAggregationName();E.addAggregation(t,b,d);}};C.prototype._activateAllValidDroppables=function(){this._iterateAllAggregations(this._activateValidDroppable.bind(this));};C.prototype._activateValidDroppable=function(A){if(this.checkDroppable(A)){A.setDroppable(true);}};C.prototype.checkDroppable=function(A){var p=A.getElementInstance();var d=this.getDraggedOverlay().getElementInstance();var s=A.getAggregationName();if(E.isValidForAggregation(p,s,d)){return true;}};C.prototype._deactivateDroppable=function(A){A.setDroppable(false);};C.prototype._activateValidDroppablesFor=function(o){this._iterateOverlayAggregations(o,this._activateValidDroppable.bind(this));};C.prototype._deactivateDroppablesFor=function(o){this._iterateOverlayAggregations(o,this._deactivateDroppable.bind(this));};C.prototype._deactivateAllDroppables=function(){this._iterateAllAggregations(function(A){A.setDroppable(false);});};C.prototype._iterateAllAggregations=function(s){var t=this;var d=E.getElementInstance(this.getDesignTime());var o=d.getOverlays();o.forEach(function(O){t._iterateOverlayAggregations(O,s);});};C.prototype._iterateOverlayAggregations=function(o,s){var A=o.getAggregationOverlays();A.forEach(function(b){s(b);});};C.prototype._repositionOn=function(t){var d=this.getDraggedOverlay().getElementInstance();var T=t.getElementInstance();var p=t.getParentElementOverlay().getElementInstance();var P=t.getParentAggregationOverlay().getAggregationName();var c=E.getAggregation(p,P);var i=c.indexOf(T);if(i!==-1){E.insertAggregation(p,P,d,i);}};return C;},true);
