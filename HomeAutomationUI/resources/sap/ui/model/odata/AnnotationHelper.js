/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2015 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./_AnnotationHelperBasics","./_AnnotationHelperExpression"],function(q,B,E){'use strict';var A,r=/^(\/dataServices\/schema\/\d+\/entityType\/\d+)(?:\/|$)/;function f(i,R){var a,c,e,I,m,M=i.getModel(),p,P,o={associationSetEnd:undefined,navigationAfterMultiple:false,isMultiple:false,navigationProperties:[],resolvedPath:undefined},s;if(R&&R.hasOwnProperty("AnnotationPath")){P=R.AnnotationPath;}else if(R&&R.hasOwnProperty("Path")){P=R.Path;}else if(R&&R.hasOwnProperty("PropertyPath")){P=R.PropertyPath;}else if(R&&R.hasOwnProperty("NavigationPropertyPath")){P=R.NavigationPropertyPath;}else{return undefined;}m=r.exec(i.getPath());if(!m){return undefined;}c=m[1];p=P.split("/");while(P&&p.length&&c){s=p[0];I=s.indexOf("@");if(I===0){c+="/"+s.slice(1);p.shift();continue;}e=M.getObject(c);a=M.getODataAssociationEnd(e,s);if(a){o.associationSetEnd=M.getODataAssociationSetEnd(e,s);o.navigationProperties.push(s);if(o.isMultiple){o.navigationAfterMultiple=true;}o.isMultiple=a.multiplicity==="*";c=M.getODataEntityType(a.type,true);p.shift();continue;}c=M.getODataProperty(e,p,true);}o.resolvedPath=c;return o;}A={format:function(i,R){if(arguments.length===1){R=i.getObject("");}return E.getExpression(i,R,true);},getNavigationPath:function(i,R){if(arguments.length===1){R=i.getObject("");}var o=f(i,R);return o?"{"+o.navigationProperties.join("/")+"}":"";},gotoEntitySet:function(c){var e,R=c.getObject(),o;if(typeof R==="string"){e=R;}else{o=f(c,R);e=o&&o.associationSetEnd&&o.associationSetEnd.entitySet;}return e?c.getModel().getODataEntitySet(e,true):undefined;},gotoEntityType:function(c){return c.getModel().getODataEntityType(c.getProperty(""),true);},gotoFunctionImport:function(c){return c.getModel().getODataFunctionImport(c.getProperty("String"),true);},isMultiple:function(i,R){if(arguments.length===1){R=i.getObject("");}var o=f(i,R);if(o){if(o.navigationAfterMultiple){throw new Error('Association end with multiplicity "*" is not the last one: '+R.AnnotationPath);}return String(o.isMultiple);}return"";},resolvePath:function(c){var R=f(c,c.getObject());return R?R.resolvedPath:undefined;},simplePath:function(i,R){if(arguments.length===1){R=i.getObject("");}return E.getExpression(i,R,false);}};A.format.requiresIContext=true;A.getNavigationPath.requiresIContext=true;A.isMultiple.requiresIContext=true;A.simplePath.requiresIContext=true;return A;},true);
