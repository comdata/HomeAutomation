/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2015 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/base/BindingParser','sap/ui/base/ManagedObject','sap/ui/core/XMLTemplateProcessor','sap/ui/Device','sap/ui/model/BindingMode','sap/ui/model/CompositeBinding','sap/ui/model/Context'],function(q,B,M,X,D,a,C,b){'use strict';var u={},N="http://schemas.sap.com/sapui5/extension/sap.ui.core.template/1",W=M.extend("sap.ui.core.util._with",{metadata:{properties:{any:"any"},aggregations:{child:{multiple:false,type:"sap.ui.core.util._with"}}}}),R=W.extend("sap.ui.core.util._repeat",{metadata:{aggregations:{list:{multiple:true,type:"n/a",_doesNotRequireFactory:true}}},updateList:function(){}});function g(w,S,i){function e(){var o=w.getBinding("any");return o instanceof C?o.getBindings()[i]:o;}return{getModel:function(){return e().getModel();},getPath:function(){var o=e();return o.getModel().resolve(o.getPath(),o.getContext());},getSetting:function(n){if(n==="bindingContexts"||n==="models"){throw new Error("Illegal argument: "+n);}return S[n];}};}function c(w,o,S){function p(I,i){var f=I.formatter;I.mode=a.OneTime;if(f&&f.requiresIContext===true){I.formatter=f.bind(null,g(w,S,i));}}try{p(o);if(o.parts){o.parts.forEach(p);}w.bindProperty("any",o);return w.getBinding("any")?w.getAny():u;}finally{w.unbindProperty("any",true);}}function d(e,L){return e.namespaceURI===N&&l(e)===L;}function l(n){return n.localName||n.baseName;}function s(e){var A,o=e.attributes,t="<"+e.nodeName,i,n;for(i=0,n=o.length;i<n;i+=1){A=o.item(i);t+=" "+A.name+'="'+A.value+'"';}return t+(e.childNodes.length?">":"/>");}return{process:function(r,v,S){var e,f=q.sap.log.isLoggable(q.sap.log.Level.DEBUG),F={},h=0,j;function k(i){if(f){q.sap.log.debug((h<10?"[ ":"[")+h+"] "+Array.prototype.slice.call(arguments,1).join(" "),i&&s(i),"sap.ui.core.util.XMLPreprocessor");}}function m(i){if(f){q.sap.log.debug((h<10?"[ ":"[")+h+"] Finished","</"+i.nodeName+">","sap.ui.core.util.XMLPreprocessor");}}function o(i,n){throw new Error(e+": "+i+s(n));}function p(L){var O=L.childNodes,P,Q=[],i,n,T=false;for(i=0,n=O.length;i<n;i+=1){P=O.item(i);if(P.nodeType===1){Q.push(P);}}if(!Q.length||!d(Q[0],"then")){return null;}for(i=1,n=Q.length;i<n;i+=1){P=Q[i];if(T){o("Expected </"+L.prefix+":if>, but instead saw ",P);}if(d(P,"else")){T=true;}else if(!d(P,"elseif")){o("Expected <"+L.prefix+":elseif> or <"+L.prefix+":else>, but instead saw ",Q[i]);}}return Q;}function t(V,i,n,L,O){var P=B.complexParser(V,null,L,true)||V;if(P.functionsNotFound){if(L){K('Function name(s) '+P.functionsNotFound.join(", ")+' not found in ',i,null);}return u;}if(typeof P==="object"){P=c(n,P,S);if(P===u){K('Binding not ready in ',i,null);}}else if(O){O();}return P;}function w(P,i,T){var n;T=T||P;I(P,i);while((n=P.firstChild)){T.parentNode.insertBefore(n,T);}}function x(i,n){var L=K.bind(null,'Constant test condition in ',i,null),O,T=i.getAttribute("test"),P;try{P=t(T,i,n,true,L);if(P===u){P=false;}}catch(Q){K('Error in formatter of ',i,Q);P=false;}O=!!P&&P!=="false";if(f){if(typeof P==="string"){P=JSON.stringify(P);}else if(P===undefined){P="undefined";}else if(Array.isArray(P)){P="[object Array]";}k(i,"test ==",P,"-->",O);}return O;}function y(i,n,L){var V=n.value,O;try{O=t(V,i,L,false);if(O!==u){if(O===undefined){if(f){k(i,"removed attribute",n.name);}i.removeAttribute(n.name);}else{if(f&&O!==n.value){k(i,n.name,"=",O);}n.value=O;}}}catch(P){if(f){q.sap.log.debug(e+': Error in formatter of '+s(i),P,"sap.ui.core.util.XMLPreprocessor");}}}function z(i,n){var L=i.getAttribute("fragmentName"),O;function P(L){var T=F[L];if(!T){T=X.loadTemplate(L,"fragment");F[L]=T;}T=T.cloneNode(true);n.$mFragmentContexts=n.$mFragmentContexts||{};if(n.$mFragmentContexts[L]){q.sap.log.error("Cyclic reference to fragment '"+L+"' ",q.sap.serializeXML(i),"sap.ui.core.util.XMLPreprocessor");return;}h++;k(i,"fragmentName =",L);n.$mFragmentContexts[L]=true;if(l(T)==="FragmentDefinition"&&T.namespaceURI==="sap.ui.core"){w(T,n,i);}else{i.appendChild(T);w(i,n);}i.parentNode.removeChild(i);n.$mFragmentContexts[L]=false;m(i);h--;}try{O=t(L,i,n,true);if(O!==u){P(O);}}catch(Q){K('Error in formatter of ',i,Q);}}function A(i,n){var L=p(i),O,T;h++;if(L){T=i;O=L.shift();do{if(x(T,n)){break;}T=O=L.shift();}while(T&&l(T)==="elseif");}else if(x(i,n)){O=i;}if(O){w(O,n,i);}i.parentNode.removeChild(i);m(i);h--;}function E(n,L){var O=n.getAttribute("list")||"",P=B.complexParser(O),Q,T,U,V,Y=n.getAttribute("var");if(Y===""){o("Missing variable name for ",n);}if(!P){o("Missing binding for ",n);}V=new R();L.setChild(V);P.mode=a.OneTime;V.bindAggregation("list",P);T=V.getBinding("list");V.unbindAggregation("list",true);U=P.model;if(!T){o("Missing model '"+U+"' in ",n);}Q=T.getContexts(P.startIndex,P.length);Y=Y||U;V.setModel(T.getModel(),Y);h++;k(n,"Starting");Q.forEach(function(Z,i){var $=(i===Q.length-1)?n:n.cloneNode(true);V.setBindingContext(Z,Y);k(n,Y,"=",Z.getPath());w($,V,n);});m(n);h--;n.parentNode.removeChild(n);}function G(i,n){var L,O,P,Q,T=i.getAttribute("helper"),U,V=i.getAttribute("path"),Y,Z=i.getAttribute("var");if(Z===""){o("Missing variable name for ",i);}P=new W();n.setChild(P);L=B.simpleParser("{"+V+"}");Z=Z||L.model;if(T||Z){O=n.getModel(L.model);if(!O){o("Missing model '"+L.model+"' in ",i);}Y=O.resolve(L.path,n.getBindingContext(L.model));if(!Y){o("Cannot resolve path for ",i);}if(T){Q=q.sap.getObject(T);if(typeof Q!=="function"){o("Cannot resolve helper for ",i);}U=Q(O.createBindingContext(Y));if(U instanceof b){O=U.getModel();Y=U.getPath();}else if(U!==undefined){if(typeof U!=="string"||U===""){o("Illegal helper result '"+U+"' in ",i);}Y=U;}}P.setModel(O,Z);P.bindObject({model:Z,path:Y});}else{P.bindObject(V);}h++;k(i,Z,"=",Y);if(P.getBindingContext(Z)===n.getBindingContext(Z)){K("Set unchanged path '"+Y+"' in ",i,null);P=n;}w(i,P);i.parentNode.removeChild(i);m(i);h--;}function H(n,L){var i,O=n.attributes;if(O){for(i=O.length-1;i>=0;i-=1){y(n,O.item(i),L);}}}function I(L,O){var i,P=L.childNodes,n=P.length,Q=new Array(n);for(i=0;i<n;i+=1){Q[i]=P.item(i);}for(i=0;i<n;i+=1){J(Q[i],O);}}function J(n,i){if(n.nodeType!==1){return;}if(n.namespaceURI===N){switch(l(n)){case"if":A(n,i);return;case"repeat":E(n,i);return;case"with":G(n,i);return;default:o("Unexpected tag ",n);}}else if(n.namespaceURI==="sap.ui.core"&&l(n)==="Fragment"&&n.getAttribute("type")==="XML"){z(n,i);return;}H(n,i);I(n,i);}function K(T,i,n){if(q.sap.log.isLoggable(q.sap.log.Level.WARNING)){q.sap.log.warning(e+": "+T+s(i),n,"sap.ui.core.util.XMLPreprocessor");}}if(typeof S==="string"){e=S;S=v;}else{e=v.caller;}S=S||{};if(f){k(undefined,"Start processing",e);if(S.bindingContexts instanceof b){k(undefined,"undefined =",S.bindingContexts);}else{for(j in S.bindingContexts){k(undefined,j,"=",S.bindingContexts[j]);}}}J(r,new W({models:S.models,bindingContexts:S.bindingContexts}));k(undefined,"Finished processing",e);return D.browser.edge||D.browser.msie&&D.os.version>=10?r.cloneNode(true):r;}};},true);
