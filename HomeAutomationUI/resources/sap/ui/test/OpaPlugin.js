/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2015 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
(function(g){"use strict";var o;if(g.module){o=g.module;g.module=undefined;}sap.ui.define(['jquery.sap.global','sap/ui/core/routing/HashChanger','sap/ui/base/Object','sap/ui/core/mvc/View','./matchers/Ancestor'],function($,H,U,V,A){var O=U.extend("sap.ui.test.OpaPlugin",{constructor:function(){var t=this;sap.ui.getCore().registerPlugin({startPlugin:function(c){t.oCore=c;},stopPlugin:function(){t.oCore=undefined;}});},getAllControls:function(c){var C,p,r=[],a=this._getCoreElements();for(p in a){if(!a.hasOwnProperty(p)){continue;}C=a[p];if(!c){r.push(C);continue;}if(C instanceof c){r.push(C);}}return r;},resetHash:function(){H.getInstance().setHash("");},getView:function(v){var a=this.getAllControls(V);return a.filter(function(b){return b.getViewName()===v;})[0];},getControlInView:function(a){var v=a.viewNamespace+a.viewName,b=this.getView(v),r=[],c,s;if(!b){$.sap.log.info("Did not find the view: "+v);return null;}if($.isArray(a.id)){$.each(a.id,function(i,I){c=b.byId(I);if(c){r.push(c);}});return r;}if(typeof a.id==="string"){return b.byId(a.id);}var d=this.getAllControlsWithTheParent(b,a.controlType);if($.type(a.id)==="regexp"){s=b.getId();d=d.filter(function(c){var u=c.getId().replace(s,"");return a.id.test(u);});}return d;},getAllControlsWithTheParent:function(p,c){var a=new A(p);return this._filterUniqueControlsByCondition(this.getAllControls(c),a);},getAllControlsInContainer:function(c,C){return this._filterUniqueControlsByCondition(c.find("*").control(),function(a){if(C){return a instanceof C;}return false;});},_filterUniqueControlsByCondition:function(c,C){return c.filter(function(a,p,b){var k=!!C(a);return k&&b.indexOf(a)===p;});},getMatchingControls:function(a){var r;if(a.searchOpenDialogs){r=this.getAllControlsInContainer($("#sap-ui-static"),a.controlType);}else if(a.viewName){r=this.getControlInView(a);}else if(a.id){r=this.getControlByGlobalId(a);}else if(a.controlType){r=this.getAllControlsInContainer($("body"),a.controlType);}else{r=null;}if(!r||a.visible===false){return r;}if(r.$){return r.$().is(":visible")?r:null;}return r.filter(function(c){return c.$().is(":visible");});},getControlByGlobalId:function(a){var t=this,s=a.id,c=[],i=[],C=this._getCoreElements();if(typeof s==="string"){c=C[s];return c&&this._checkControlType(c,a)?c:null;}if($.type(s)==="regexp"){for(var p in C){if(!C.hasOwnProperty(p)){continue;}if(!s.test(p)){continue;}i.push(p);}}else if($.isArray(s)){i=s;}return i.map(function(I){return C[I];}).filter(function(b){return t._checkControlType(b,a)&&b&&!b.bIsDestroyed;});},_getCoreElements:function(){var e={};if(!this.oCore){return e;}return this.oCore.mElements||e;},_checkControlType:function(c,a){if(a.controlType){return c instanceof a.controlType;}else{return true;}}});return O;},true);if(o){g.module=o;}})(window);
