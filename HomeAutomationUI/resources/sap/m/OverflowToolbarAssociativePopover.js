/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2015 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['./Popover','./PopoverRenderer','./OverflowToolbarAssociativePopoverControls'],function(P,a,O){"use strict";var b=P.extend("sap.m._overflowToolbarHelpers.OverflowToolbarAssociativePopover",{metadata:{associations:{associatedContent:{type:"sap.ui.core.Control",multiple:true}}},renderer:a.render});b.prototype.init=function(){P.prototype.init.apply(this,arguments);if(sap.ui.Device.system.phone){this._removeOffsetTakenByTheArrow();}this.oControlsManager=new O();};b.prototype.onBeforeRendering=function(){P.prototype.onBeforeRendering.apply(this,arguments);this.addStyleClass("sapMOTAPopover");var h=this._getAllContent().some(function(C){return C.hasStyleClass("sapMOTAPButtonWithIcon");});if(h){this.addStyleClass("sapMOTAPButtonsWithIcons");}else{this.removeStyleClass("sapMOTAPButtonsWithIcons");}};b.prototype._removeOffsetTakenByTheArrow=function(){this._marginTop=0;this._marginLeft=0;this._marginRight=0;this._marginBottom=0;this._arrowOffset=0;this._offsets=["0 0","0 0","0 0","0 0"];this._myPositions=["begin bottom","begin center","begin top","end center"];this._atPositions=["begin top","end center","begin bottom","begin center"];};b.prototype.addAssociatedContent=function(C){this.addAssociation("associatedContent",C,true);this._preProcessControl(C);return this;};b.prototype.removeAssociatedContent=function(C){var r=this.removeAssociation("associatedContent",C,true),o;if(r){o=sap.ui.getCore().byId(r);this._postProcessControl(o);}return r;};b.prototype._preProcessControl=function(C){var s=C.getMetadata().getName(),o=O.getControlConfig(C),A,p;o.listenForEvents.forEach(function(e){A="attach"+c(e);C[A](this._closeOnInteraction,this);},this);p="_preProcess"+s.split(".").map(c).join("");if(typeof this.oControlsManager[p]==="function"){this.oControlsManager[p](C);}return this;};b.prototype._postProcessControl=function(C){var s=C.getMetadata().getName(),o=O.getControlConfig(C),d,p;o.listenForEvents.forEach(function(e){d="detach"+c(e);C[d](this._closeOnInteraction,this);},this);p="_postProcess"+s.split(".").map(c).join("");if(typeof this.oControlsManager[p]==="function"){this.oControlsManager[p](C);}C.$().remove();return this;};b.prototype._closeOnInteraction=function(){this.close();};b.prototype._getContentIdsHash=function(){return this._getAllContent().join(".");};b.prototype._getAllContent=function(){var A=this.getAssociatedContent().map(function(i){return sap.ui.getCore().byId(i);});if(this.getPlacement()===sap.m.PlacementType.Top){A.reverse();}return this.getContent().concat(A);};b.prototype.getCurrentPosition=function(){return this._oCalcedPos;};b.prototype._calcPlacement=function(){var r=P.prototype._calcPlacement.call(this);this.fireAfterOpen({});return r;};function c(n){return n.substring(0,1).toUpperCase()+n.substring(1);}return b;},false);
